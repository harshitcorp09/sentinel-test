import "tfplan/v2" as plan

# Define the main rule
main = rule {
    # Access Terraform plan data
    instances = plan.resources["aws_instance"]
    
    # Check if instances are of allowed types
    all_in_allowed_types(instances[*].attributes.instance_type)
}

# Allowed EC2 Instance Types
allowed_types = ["t2.small", "t2.medium", "t2.large"]

# Function to check if all instances are in allowed types
all_in_allowed_types(types) {
    all type in types {
        type is allowed_types[_]
    }
}
